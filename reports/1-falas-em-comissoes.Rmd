---
title: "Falas nas comissões permanentes"
output:
  html_document:
    theme: paper
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  # message = FALSE,
  # warning = FALSE,
  # fig.cap = '',
  # fig.align = 'center',
  fig.width = 6,
  fig.height = 5
)
Sys.setenv(LANGUAGE="pt-br")
Sys.setlocale("LC_TIME", "pt_BR")
options(scipen = 999)
```

```{r warning=FALSE, message=FALSE}
library(tidyverse)
library(reactable)
library(ggchicklet)
library(ggbeeswarm)
library(hrbrthemes)
theme_set(theme_ipsum_rc())

# source(here::here("code/read_ready.R"))
```

### Totais

```{r}
falas = read_csv(here::here("data/ready/falas-comissoes.csv"), 
                 col_types = "cicclccc")
```



```{r}
falas %>% 
    mutate(palavras = str_count(transcricao, '\\w+'), 
           caracteres = str_length(transcricao)) %>% 
    summarise(falas = n(), 
              eventos = n_distinct(id_evento),
              total_palavras = sum(palavras, na.rm = T),
              mediana_palavras = median(palavras, na.rm = T), 
              mediana_caracteres = median(caracteres, na.rm = T)) %>% 
    reactable()
```

### Alguns exemplos

```{r}
set.seed(1313)
falas %>% 
    select(nome, partido, uf, transcricao) %>% 
    sample_n(10) %>% 
    reactable(striped = T)
```


```{r}
falas %>% 
    count(id_evento) %>% 
    ggplot(aes(x = n)) + 
    geom_histogram(binwidth = 30, boundary = 0, fill = "steelblue") + 
    labs(title = "Número de falas por evento", 
         x = "Falas", 
         y = "Eventos")
```

```{r}
falas %>% 
    filter(parlamentar) %>% 
    mutate(nome_display = str_glue("{nome} ({partido}-{uf})")) %>% 
    count(nome_display) %>% 
    mutate(n = pmin(n, 2000)) %>% 
    ggplot(aes(x = n)) + 
    geom_histogram(binwidth = 50, boundary = 0, fill = "coral") + 
    labs(title = "Número de falas por parlamentar", 
         x = "Falas", 
         y = "Parlamentares")
```


```{r}
falas %>% 
    filter(parlamentar) %>% 
    mutate(nome = str_glue("{nome} ({partido}-{uf})")) %>% 
    count(nome, sort = T, name = "falas") %>% 
    reactable(striped = T, searchable = T)
```

