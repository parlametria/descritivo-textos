---
title: "Textos de proposições"
output:
  html_document:
    theme: paper
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  # message = FALSE,
  # warning = FALSE,
  # fig.cap = '',
  # fig.align = 'center',
  fig.width = 6,
  fig.height = 5
)
Sys.setenv(LANGUAGE="pt-br")
Sys.setlocale("LC_TIME", "pt_BR")
options(scipen = 999)
```

```{r warning=FALSE, message=FALSE}
library(tidyverse)
library(reactable)
library(ggchicklet)
library(ggbeeswarm)
library(hrbrthemes)
library(here)
theme_set(theme_ipsum_rc())
```

## Quantidade de proposições

```{r}
proposicoes = readr::read_csv(here::here("data/ready/proposicoes.csv"),
                              col_types = "cciTiccccTc")
```

```{r}
totais = proposicoes %>% 
  summarise(palavras_proposicoes = str_count(text_prop, '\\w+'),
            palavras_ementas = str_count(ementa, '\\w+'),
            caracteres_proposicoes = str_length(text_prop),
            caracteres_ementas = str_length(ementa))
```

### Totais

```{r}
totais %>% 
  summarise(Proposicoes = n(),
            `Palavras (milhões)` = round(sum(palavras_proposicoes, na.rm = T) / 1e6, 1),
            `Mediana palavras` = median(palavras_proposicoes, na.rm = T),
            `Mediana caracteres` = median(caracteres_proposicoes, na.rm = T)) %>% 
  reactable()
```
### Por ano

```{r}
proposicoes %>% 
  count(ano, sort = T) %>% 
  ggplot(aes(x = ano,
             y = n)) +
  geom_chicklet(fill = "steelblue") +
  labs(x = NULL,
       y = "nº de proposições",
       title = "Proposições por ano")
```

### Por tipo

```{r}
proposicoes %>% 
  count(siglaTipo) %>% 
  slice_max(order_by = n,
            n = 15) %>% 
  ggplot(aes(x = reorder(siglaTipo, -n),
             y = n)) +
  geom_chicklet(width = .7,
                fill = "tomato") +
  labs(x = "Tipo",
       y = "Quantidade",
       title = "Tipos de proposições mais frequentes")
```


## Alguns exemplos

```{r}
set.seed(13)
proposicoes %>% 
  select(siglaTipo, numero, ano, text_prop) %>% 
  mutate(text_prop = str_sub(text_prop, 0, 200)) %>% 
  sample_n(5) %>% 
  reactable(striped = T)
```

## Ementas

```{r}
ementas = totais %>% 
  summarise(`Palavras (Milhões)` = round(sum(palavras_ementas, na.rm = T) / 1e6, 1),
            `Mediana palavras` = median(palavras_ementas, na.rm = T),
            `Mediana caracteres` = median(caracteres_ementas, na.rm = T))

ementas %>% reactable()
```

